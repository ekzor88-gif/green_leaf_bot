# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫–∏–π –æ–±—Ä–∞–∑ Python 3.11
FROM python:3.11-slim

# –û—Ç–∫–ª—é—á–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ .pyc —Ñ–∞–π–ª–æ–≤ –∏ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –≤—ã–≤–æ–¥–∞ (—á—Ç–æ–±—ã –ª–æ–≥–∏ —à–ª–∏ —Å—Ä–∞–∑—É)
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

WORKDIR /app

# –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –∏ —Å—Ç–∞–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Docker)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
COPY . .

# üí° –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —á–µ—Ä–µ–∑ Gunicorn –¥–ª—è production.
# Gunicorn –±—É–¥–µ—Ç —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $PORT, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Cloud Run.
# –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π "–≤–æ—Ä–∫–µ—Ä" –¥–ª—è aiohttp –∏ —É–∫–∞–∑—ã–≤–∞–µ–º Gunicorn, –≥–¥–µ –Ω–∞–π—Ç–∏ –Ω–∞—à–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`bot:app`).
CMD ["gunicorn", "--bind", ":8080", "--workers", "1", "--worker-class", "aiohttp.worker.GunicornWebWorker", "bot:app"]